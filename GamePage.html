<!DOCTYPE html>

<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
        <link rel="stylesheet" href="horizontal_accordion.css" type="text/css">
        <link rel="stylesheet" href="page_styling.css" type="text/css">
        <script src="js-db-functions.js"></script> <!-- reference to JavaScript file with all JavaScripts written for website -->
        <title>Game Ratings</title>
        <script> 
            function showDescription() {
                var xmlhttpGameData = new XMLHttpRequest();
                var strings = window.location.search.split("=");
                var gameID = strings[1];
                var pubID;
                var devID;

                xmlhttpGameData.onreadystatechange = function() {
                    if(this.readyState == 4 && this.status == 200) {
                        const gameData = JSON.parse(this.responseText);

                        var dateParse = JSON.parse(JSON.stringify(gameData['GameData']["ReleaseDate"]));
                        var date = JSON.stringify(dateParse["date"]).split(" ");
                        date = date[0].split("\"");

                        document.getElementById("Title").innerHTML = gameData['GameData']["GameName"];
                        document.getElementById("BoxArt").innerHTML = "<img src=\"" + gameData['GameData']["BoxArt"] + "\" class=\"box-art\">";
                        document.getElementById("Description").innerHTML = gameData['GameData']["Description"];
                        document.getElementById("ReleaseDate").innerHTML = date[1];
                        document.getElementById("Genre").innerHTML = gameData['GameData']["Genre"];

                        pubID = gameData['GameData']["PubID"];
                        devID = gameData['GameData']["DevID"];
                    }
                };
                xmlhttpGameData.open("GET", "GameData.php?q=" + gameID, false);
                xmlhttpGameData.send();

                var xmlhttpDev = new XMLHttpRequest();

                xmlhttpDev.onreadystatechange = function() {
                    if(this.readyState == 4 && this.status == 200) {
                        document.getElementById("Developer").innerHTML = this.responseText;
                    }
                };
                xmlhttpDev.open("GET", "DevData.php?q=" + devID, false);
                xmlhttpDev.send();

                var xmlhttpPub = new XMLHttpRequest();

                xmlhttpPub.onreadystatechange = function() {
                    if(this.readyState == 4 && this.status == 200) {
                        document.getElementById("Publisher").innerHTML = this.responseText;
                    }
                };
                xmlhttpPub.open("GET", "PubData.php?q=" + pubID, false);
                xmlhttpPub.send();

                var xmlhttpPlatforms = new XMLHttpRequest();

                xmlhttpPlatforms.onreadystatechange = function() {
                    if(this.readyState == 4 && this.status == 200) {
                        document.getElementById("PlatformData").innerHTML = this.responseText;
                    }
                };
                xmlhttpPlatforms.open("GET", "PlatformsData.php?q=" + gameID, false);
                xmlhttpPlatforms.send();

                var xmlhttpPageCount = new XMLHttpRequest();

                xmlhttpPageCount.onreadystatechange = function() {
                    if(this.readyState == 4 && this.status == 200) {

                    }
                }
                xmlhttpPageCount.open("GET", "ViewCount.php?q=" + gameID, false);
                xmlhttpPageCount.send();

                var xmlhttpAverage = new XMLHttpRequest();
                var count = 0;
                var average;
                
                xmlhttpAverage.onreadystatechange = function() {
                    if(this.readyState == 4 && this.status == 200) {
                        document.getElementById("Average").innerHTML = this.responseText;
                    }
                };
                xmlhttpAverage.open("GET", "Average.php?q=" + gameID, false);
                xmlhttpAverage.send();

                var xmlhttpReviewData = new XMLHttpRequest();
                var reviewsTable = "<table style=\"width: 100%\"><colgroup><col span=\"1\" style=\"width: 30%\"><col span=\"1\" style=\"width: 30%\"><col span=\"1\" style=\"width: 10%\"><col span=\"1\" style=\"width: 15%\"><col span=\"1\" style=\"width: 15%\"></colgroup>";
                reviewsTable += "<tr><th style=\"text-align: left\"><b>Publication</b></th><th style=\"text-align: left\"><b>Review</b></th><th style=\"text-align: left\"><b>Date</b></th><th style=\"text-align: right\"><b>Score</b></th><th style=\"text-align: right\"><b>Percentage</b></th></tr>";
                
                xmlhttpReviewData.onreadystatechange = function() {
                    if(this.readyState == 4 && this.status == 200) {
                        reviewsTable += this.responseText;
                        reviewsTable += "</table>";

                        document.getElementById("ReviewData").innerHTML = reviewsTable;
                    }
                };
                xmlhttpReviewData.open("GET", "ReviewData.php?q=" + gameID, false);
                xmlhttpReviewData.send();
            }
        </script>
    </head>

    <body class="d-flex flex-column text-white" style="background-color: #343a40;"  onLoad="showDescription()">
        <!-- Navbar with Site Icon, Title and Search bar -->
        <!-- Create navbar that shows search bar and button on medium screens or larger and stays fixed to the top when scrolling -->
        <nav class="navbar navbar-expand-md top navbar-dark bg-dark px-1" style="z-index: 2;">
            <div class="container-xxl"> <!-- use xxl container to keep icon/title and search bar/button no further than a certain distance from each other in case viewed on extremely large screens  -->
                <!-- set the icon for the website and the title (current doesn't link to anything, but will be homepage button)-->
                <a href="https://gameratingsapp.com/" class="navbar-brand">
                    <span class="fw-bold text-white h1">
                        <i class="bi bi-joystick"></i>
                        Game Ratings
                    </span>
                </a>

                <!-- nav button that appears on smaller screens such as mobile/phone screens -->
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSearchField">
                    <i class="bi bi-search"></i> <!-- collapsed navbar icon -->
                </button>

                <!-- Search bar and submit button for searching games on site. Enclosed in div that hides the search bar and button behind the above navbar toggler button on smaller screen sizes -->
                <div class="collapse navbar-collapse justify-content-end" id="navbarSearchField">
                    <form  action="search.html" class="d-flex" role="search">
                        <input type="search" id="Game" name="Game" class="form-control me-2" placeholder="Search...">

                        <!-- hidden search fields to feed search filters once search button is clicked -->
                        <input type="hidden" id="Dev" name="Developer">
                        <input type="hidden" id="Pub" name="Publisher">
                        <input type="hidden" id="Platform" name="Platform">
                        <input type="hidden" id="Year" name="Year">

                        <!-- search button -->
                        <button class="btn btn-outline-light fw-bold" type="submit">Search</button>
                    </form>
                </div>
            </div>
        </nav>

            <div style="width: 800px;">
                <body>
                    <p><b><span style="font-size: 50px;" id="Title"></span></b></p>
                </body>
            </div>
            <h4 style="width: 800px; height: 20px; background-color: #6666ff; color: white">&nbspAggregated Score</h4>
            <div style="width: 800px; font-size: 50px;">
                <body>
                    <b><span id="Average"></span></b>
                </body>
            </div>
            <h4 style="width:800px; height: 20px; background-color: #6666ff; color: white">&nbspDescription</h4>
            <div style="width: 800px;word-wrap: break-word;">
                <body>
                    <span id="BoxArt"></span><span id="Description"></span><br><br>
                    <span class="text-under-image">
                        <br><b>Developer: </b><span id="Developer"></span><br>
                        <b>Publisher: </b><span id="Publisher"></span><br>
                        <b>Genre: </b><span id="Genre"></span><br>
                        <b>Platform: </b><span id="PlatformData"></span><br>
                        <b>Release Date: </b><span id="ReleaseDate"></span>
                    </span>
                </body>
            </div>
            <h4 style="width: 800px; height: 20px; background-color: #6666ff; color: white">&nbspReviews</h4>
            <div style="width: 800px; display: table;">
                <div style="display: table-row;">
                    <div class="border" style="width: 100%; display: table-cell;">
                        <span id="ReviewData"></span>
                    </div>
                </div>
            </div>
            
        </div>
    </body>
</html>